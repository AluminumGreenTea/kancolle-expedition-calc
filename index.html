<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš“ è‰¦éšŠæ”¶è—ï¼šé å¾æ”¶ç›Šè¨ˆç®—æ©Ÿ</title>
    <style>
        :root {
            --primary: #2c3e50; --fuel: #27ae60; --ammo: #d4ac0d; --steel: #7f8c8d; --bauxite: #e67e22; 
            --score: #8e44ad; --bucket: #2980b9; --bg-gray: #f4f7f6; --devmat: #16a085;
        }
        
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background: var(--bg-gray); padding: 20px; color: #333; line-height: 1.4; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* é ‚éƒ¨æ¨è–¦ */
        .recommend-box { 
            background: linear-gradient(135deg, #2c3e50, #4ca1af); 
            color: white; padding: 20px; border-radius: 12px; margin-bottom: 25px;
            display: flex; justify-content: space-between; align-items: center; gap: 20px;
            flex-wrap: wrap;
        }

        .rec-title { font-size: 1.3em; font-weight: bold; border-left: 5px solid #f39c12; padding-left: 15px; }
        .rec-cards { display: flex; gap: 10px; flex: 1; margin: 0 20px; }
        .rec-card { background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; flex: 1; text-align: center; border: 1px solid rgba(255,255,255,0.3); }
        .rec-total { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-size: 0.9em;  line-height: 1.6; }

        /* æ™‚é–“æ»‘æ¡¿ */
        .time-box { background: #fff; border: 3px solid var(--primary); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .time-display { font-size: 1.8em; font-weight: bold; color: var(--primary); margin-bottom: 10px; }
        .main-slider { width: 90%; height: 15px; cursor: pointer; }

        /* å·¥å…·åˆ— */
        .tool-bar { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 2; min-width: 200px; padding: 12px; border: 2px solid var(--primary); border-radius: 8px; font-size: 1.1em; }
        .btn { padding: 10px 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; font-size: 13px; background: #7f8c8d;}  
        .btn-toggle.active { background: #e74c3c; border: 1px solid #000; }
        .btn-gs.active { background: #f39c12; border: 1px solid #000; }
        .btn-mon.active { background: #9b59b6; border: 1px solid #000; }

        /* æ¬Šé‡é¢æ¿ */
        .control-panel { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
            gap: 12px; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;
        }
        .-titlesection { grid-column: 1 / -1; font-weight: bold; color: var(--primary); border-bottom: 2px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; }
        .weight-item { display: flex; flex-direction: column; gap: 5px; }
        .weight-item label { font-size: 0.85em; font-weight: bold; }
        .weight-item input { padding: 6px; border: 1px solid #ccc; border-radius: 4px; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary); color: white; padding: 12px; font-size: 13px; position: sticky; top: 0; cursor: pointer; }
        td { border-bottom: 1px solid #eee; padding: 10px; text-align: center; font-size: 14px; }
        tr:hover { background-color: #f1f7ff; }
        tr.disabled { opacity: 0.3; filter: grayscale(0.8); background: #f9f9f9; }
        
        /* TAG */
        .area-tag { font-size: 10px; color: #7f8c8d; display: block; margin-top: 2px; }
        .badge { font-size: 11px; padding: 3px 7px; border-radius: 4px; color: white; margin-right: 3px; display: inline-block; font-weight: bold; }
        .tag-bucket { background: var(--bucket); }
        .tag-fuel { background: var(--fuel); }
        .tag-ammo { background: var(--ammo); }
        .tag-steel { background: var(--steel); }
        .tag-bauxite { background: var(--bauxite); }
        .tag-monthly { background: #8e44ad; }
        .tag-combat { background: #e74c3c; }


        .res-val { font-weight: bold; }
        .score-col { background: #fdfaff; font-weight: bold; color: var(--score); }
    </style>
</head>
<body>

<div class="container">
    <div class="recommend-box">
        <div class="rec-title">ğŸš€ æ¨è–¦çµ„åˆ (æ™‚æ”¶æœ€é«˜)</div>
        <div class="rec-cards" id="recFleetCards"></div>
        <div class="rec-cards rec-total" id="recTotalStats"></div>
    </div>

    <div class="time-box">
        <div class="time-display">â° æç£é–“æ ¼æ”¶ç²æ™‚é–“ï¼š<span id="textTime">0 å°æ™‚ 0 åˆ†é˜</span></div>
        <input type="range" id="intervalSlider" class="main-slider" min="0" max="720" step="5" value="0" oninput="updateTime()">
    </div>

    <div class="tool-bar">
        <input type="text" id="searchBar" class="search-box" placeholder="æœå°‹ç·¨è™Ÿã€åç¨±ã€æµ·åŸŸæˆ–æ¨™ç±¤..." oninput="updateUI()">
        <button class="btn" style="background:#27ae60" onclick="applyPreset('fuel')">â›½ ç¼ºç‡ƒæ–™</button>
        <button class="btn" style="background:#d4ac0d" onclick="applyPreset('ammo')">ğŸ’£ ç¼ºå½ˆè—¥</button>
        <button class="btn" style="background:#62676e" onclick="applyPreset('steel')">ğŸ—ï¸ ç¼ºé‹¼æ</button>
        <button class="btn" style="background:#ffa600" onclick="applyPreset('bauxite')">âœˆï¸ ç¼ºé‹åœŸ</button>
        <button class="btn" style="background:#2980b9" onclick="applyPreset('bucket')">ğŸ’§ ç¼ºæ¡¶</button>
        <button class="btn" style="background:#7f8c8d" onclick="applyPreset('reset')">ğŸ”„ é‡ç½®</button>
        <button id="btnGS" class="btn btn-gs" onclick="toggleOption('isGS')">âœ¨ å¤§æˆåŠŸ: OFF</button>
        <button id="btnMon" class="btn btn-mon" onclick="toggleOption('hideMonthly')">ğŸš« éš±è—æœˆå¸¸: OFF</button>
        <button id="btnLimit" class="btn btn-toggle" onclick="toggleOption('hideIncompatible')">â³ éš±è—ä¸åˆé©: OFF</button>
    </div>

    <div class="" id="weightPanel">
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th width="70" onclick="resort('id')">ID</th>
                <th style="text-align:left">é å¾åç¨± / æ¨™ç±¤</th>
                <th width="80" onclick="resort('duration')">æ™‚é–“</th>
                <th width="80" onclick="resort('yFuel')">ç‡ƒæ–™/hr</th>
                <th width="80" onclick="resort('yAmmo')">å½ˆè—¥/hr</th>
                <th width="80" onclick="resort('ySteel')">é‹¼æ/hr</th>
                <th width="80" onclick="resort('yBaux')">é‹åœŸ/hr</th>
                <th width="140">å‰¯ç”¢ç‰©/hr</th>
                <th width="90" onclick="resort('score')" class="score-col">ç¶œåˆè©•åˆ†</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<script>

const expeditionDB = [
    // --- ç¬¬ 1 æµ·åŸŸï¼šé®å®ˆåºœæµ·åŸŸ ---
    {id:"1", area:"1", name:"ç·´ç¿’èˆªæµ·", duration:15, fuel:0, ammo:30, steel:0, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},   
    {id:"2", area:"1", name:"é•·è·é›¢ç·´ç¿’èˆªæµ·", duration:30, fuel:0, ammo:100, steel:30, bauxite:0, bucket:1, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æ°´æ¡¶"]},
    {id:"3", area:"1", name:"è­¦å‚™ä»»å‹™", duration:20, fuel:30, ammo:30, steel:40, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},
    {id:"4", area:"1", name:"å¯¾æ½œè­¦æˆ’ä»»å‹™", duration:50, fuel:0, ammo:70, steel:0, bauxite:0, bucket:1, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æ°´æ¡¶"]},
    {id:"5", area:"1", name:"æµ·ä¸Šè­·è¡›ä»»å‹™", duration:90, fuel:200, ammo:200, steel:20, bauxite:20, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","ç‡ƒæ–™","å½ˆè—¥"]},
    {id:"6", area:"1", name:"é˜²ç©ºå°„æ’ƒæ¼”ç¿’", duration:40, fuel:0, ammo:0, steel:0, bauxite:80, bucket:0, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","é‹åœŸ"]},
    {id:"7", area:"1", name:"è¦³è‰¦å¼äºˆè¡Œ", duration:60, fuel:0, ammo:0, steel:50, bauxite:30, bucket:0, torch:1, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},
    {id:"8", area:"1", name:"è¦³è‰¦å¼", duration:180, fuel:50, ammo:100, steel:50, bauxite:50, bucket:0, torch:2, devMat:1, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},
    {id:"A1", area:"1", name:"å…µç«™å¼·åŒ–ä»»å‹™", duration:25, fuel:45, ammo:45, steel:0, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},
    {id:"A2", area:"1", name:"æµ·å³¡è­¦å‚™è¡Œå‹•", duration:55, fuel:70, ammo:40, steel:0, bauxite:10, bucket:1, torch:0, devMat:1, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æ°´æ¡¶"]},
    {id:"A3", area:"1", name:"é•·æ™‚é–“å¯¾æ½œè­¦æˆ’", duration:135, fuel:120, ammo:0, steel:60, bauxite:60, bucket:1, torch:0, devMat:2, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ"]},
    {id:"A4", area:"1", name:"å—è¥¿æ–¹é¢é€£çµ¡ç·šå“¨æˆ’", duration:110, fuel:80, ammo:120, steel:0, bauxite:100, bucket:2, torch:2, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æœˆå¸¸"]},
    {id:"A5", area:"1", name:"å°ç¬ åŸæ²–å“¨æˆ’ç·š", duration:180, fuel:0, ammo:300, steel:0, bauxite:100, bucket:3, torch:0, devMat:4, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"A6", area:"1", name:"å°ç¬ åŸæ²–æˆ¦é—˜å“¨æˆ’", duration:210, fuel:100, ammo:500, steel:100, bauxite:200, bucket:0, torch:0, devMat:5, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬1æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},

    // --- ç¬¬ 2 æµ·åŸŸï¼šå—è¥¿è«¸å³¶æµ·åŸŸ ---
    {id:"9", area:"2", name:"ã‚¿ãƒ³ã‚«ãƒ¼è­·è¡›ä»»å‹™", duration:240, fuel:350, ammo:0, steel:0, bauxite:0, bucket:2, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","ç‡ƒæ–™"]},
    {id:"10", area:"2", name:"å¼·è¡Œåµå¯Ÿä»»å‹™", duration:90, fuel:0, ammo:50, steel:0, bauxite:40, bucket:1, torch:1, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"11", area:"2", name:"ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆè¼¸é€ä»»å‹™", duration:300, fuel:0, ammo:0, steel:0, bauxite:250, bucket:1, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","é‹åœŸ"]},
    {id:"12", area:"2", name:"è³‡æºè¼¸é€ä»»å‹™", duration:480, fuel:50, ammo:250, steel:200, bauxite:50, bucket:0, torch:0, devMat:1, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"13", area:"2", name:"é¼ è¼¸é€ä½œæˆ¦", duration:240, fuel:240, ammo:300, steel:0, bauxite:0, bucket:2, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","ç‡ƒæ–™","å½ˆè—¥"]},
    {id:"14", area:"2", name:"åŒ…å›²é™¸æˆ¦éšŠæ’¤åä½œæˆ¦", duration:360, fuel:0, ammo:280, steel:200, bauxite:30, bucket:1, torch:0, devMat:1, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"15", area:"2", name:"å›®æ©Ÿå‹•éƒ¨éšŠæ”¯æ´ä½œæˆ¦", duration:720, fuel:0, ammo:0, steel:300, bauxite:400, bucket:0, torch:0, devMat:1, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"16", area:"2", name:"è‰¦éšŠæ±ºæˆ¦æ´è­·ä½œæˆ¦", duration:900, fuel:500, ammo:500, steel:200, bauxite:200, bucket:0, torch:2, devMat:2, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"B1", area:"2", name:"å—è¥¿æ–¹é¢èˆªç©ºåµå¯Ÿä½œæˆ¦", duration:35, fuel:0, ammo:0, steel:20, bauxite:30, bucket:1, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ"]},
    {id:"B2", area:"2", name:"æ•µæ³Šåœ°å¼·è¥²åæ’ƒä½œæˆ¦", duration:520, fuel:300, ammo:200, steel:100, bauxite:0, bucket:2, torch:0, devMat:2, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","æœˆå¸¸"]},
    {id:"B3", area:"2", name:"å—è¥¿è«¸å³¶é›¢å³¶å“¨æˆ’ä½œæˆ¦", duration:170, fuel:0, ammo:100, steel:100, bauxite:180, bucket:2, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬2æµ·åŸŸ","æœˆå¸¸"]},
    {id:"B4", area:"2", name:"å—è¥¿è«¸å³¶é›¢å³¶é˜²è¡›ä½œæˆ¦", duration:450, fuel:0, ammo:0, steel:1200, bauxite:650, bucket:0, torch:0, devMat:4, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"B5", area:"2", name:"å—è¥¿è«¸å³¶æœç´¢æ’ƒæ»…æˆ¦", duration:390, fuel:500, ammo:500, steel:1000, bauxite:750, bucket:4, torch:0, devMat:0, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"B6", area:"2", name:"ç²¾é‹­æ°´é›·æˆ¦éšŠå¤œè¥²", duration:350, fuel:600, ammo:1000, steel:600, bauxite:600, bucket:0, torch:0, devMat:5, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬2æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},

    // --- ç¬¬ 3 æµ·åŸŸï¼šåŒ—æ–¹æµ·åŸŸ ---
    {id:"17", area:"3", name:"æ•µåœ°åµå¯Ÿä½œæˆ¦", duration:45, fuel:70, ammo:90, steel:50, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"18", area:"3", name:"èˆªç©ºæ©Ÿè¼¸é€ä½œæˆ¦", duration:300, fuel:0, ammo:0, steel:300, bauxite:150, bucket:1, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"19", area:"3", name:"åŒ—å·ä½œæˆ¦", duration:360, fuel:400, ammo:50, steel:50, bauxite:30, bucket:0, torch:0, devMat:1, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"20", area:"3", name:"æ½œæ°´è‰¦å“¨æˆ’ä»»å‹™", duration:120, fuel:0, ammo:0, steel:150, bauxite:0, bucket:0, torch:0, devMat:1, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"21", area:"3", name:"åŒ—æ–¹é¼ è¼¸é€ä½œæˆ¦", duration:140, fuel:320, ammo:270, steel:0, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ","ç‡ƒæ–™","å½ˆè—¥"]},
    {id:"22", area:"3", name:"è‰¦éšŠæ¼”ç¿’", duration:180, fuel:0, ammo:10, steel:0, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"23", area:"3", name:"èˆªç©ºæˆ¦è‰¦é‹ç”¨æ¼”ç¿’", duration:240, fuel:0, ammo:50, steel:0, bauxite:130, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬3æµ·åŸŸ"]},
    {id:"24", area:"3", name:"åŒ—æ–¹èˆªè·¯æµ·ä¸Šè­·è¡›", duration:500, fuel:500, ammo:0, steel:0, bauxite:150, bucket:1, torch:0, devMat:2, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬3æµ·åŸŸ","ç‡ƒæ–™"]},

    // --- ç¬¬ 4 æµ·åŸŸï¼šè¥¿æ–¹æµ·åŸŸ ---
    {id:"25", area:"4", name:"é€šå•†ç ´å£Šä½œæˆ¦", duration:2400, fuel:900, ammo:0, steel:500, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"26", area:"4", name:"æ•µæ¯æ¸¯ç©ºè¥²ä½œæˆ¦", duration:4800, fuel:0, ammo:0, steel:0, bauxite:900, bucket:3, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"27", area:"4", name:"æ½œæ°´è‰¦é€šå•†ç ´å£Šä½œæˆ¦", duration:1200, fuel:0, ammo:0, steel:800, bauxite:0, bucket:0, torch:0, devMat:2, screw:0, boxS:2, boxM:0, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"28", area:"4", name:"è¥¿æ–¹æµ·åŸŸå°é–ä½œæˆ¦", duration:1500, fuel:0, ammo:0, steel:900, bauxite:350, bucket:0, torch:0, devMat:3, screw:0, boxS:0, boxM:2, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"29", area:"4", name:"æ½œæ°´è‰¦æ´¾é£æ¼”ç¿’", duration:1440, fuel:0, ammo:50, steel:0, bauxite:100, bucket:0, torch:0, devMat:1, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"30", area:"4", name:"æ½œæ°´è‰¦æ´¾é£ä½œæˆ¦", duration:2880, fuel:0, ammo:50, steel:0, bauxite:100, bucket:0, torch:0, devMat:3, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"31", area:"4", name:"æµ·å¤–è‰¦ã¨ã®æ¥è§¦", duration:120, fuel:0, ammo:30, steel:0, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"32", area:"4", name:"é æ´‹ç·´ç¿’èˆªæµ·", duration:1440, fuel:50, ammo:50, steel:50, bauxite:50, bucket:0, torch:0, devMat:3, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"D1", area:"4", name:"è¥¿æ–¹æµ·åŸŸåµå¯Ÿä½œæˆ¦", duration:120, fuel:0, ammo:20, steel:20, bauxite:100, bucket:1, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬4æµ·åŸŸ"]},
    {id:"D2", area:"4", name:"è¥¿æ–¹æ½œæ°´è‰¦ä½œæˆ¦", duration:600, fuel:0, ammo:0, steel:400, bauxite:800, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬4æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"D3", area:"4", name:"æ¬§å·æ–¹é¢å‹è»ã¨ã®æ¥è§¦", duration:720, fuel:0, ammo:800, steel:500, bauxite:400, bucket:3, torch:0, devMat:0, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬4æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},

    // --- ç¬¬ 5 æµ·åŸŸï¼šå—æ–¹æµ·åŸŸ ---
    {id:"35", area:"5", name:"MOä½œæˆ¦", duration:420, fuel:0, ammo:0, steel:240, bauxite:280, bucket:0, torch:0, devMat:1, screw:0, boxS:2, boxM:0, boxL:0, tags:["ç¬¬5æµ·åŸŸ","é‹åœŸ"]},
    {id:"36", area:"5", name:"æ°´ä¸Šæ©ŸåŸºåœ°å»ºè¨­", duration:540, fuel:480, ammo:0, steel:200, bauxite:200, bucket:1, torch:0, devMat:0, screw:0, boxS:0, boxM:2, boxL:0, tags:["ç¬¬5æµ·åŸŸ","ç‡ƒæ–™"]},
    {id:"37", area:"5", name:"æ±äº¬æ€¥è¡Œ", duration:165, fuel:0, ammo:380, steel:270, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬5æµ·åŸŸ","å½ˆè—¥","é‹¼æ"]},
    {id:"38", area:"5", name:"æ±äº¬æ€¥è¡Œï¼ˆå¼ï¼‰", duration:175, fuel:420, ammo:0, steel:200, bauxite:0, bucket:0, torch:0, devMat:0, screw:0, boxS:1, boxM:0, boxL:0, tags:["ç¬¬5æµ·åŸŸ","ç‡ƒæ–™","é‹¼æ"]},
    {id:"39", area:"5", name:"é æ´‹æ½œæ°´è‰¦ä½œæˆ¦", duration:1800, fuel:0, ammo:0, steel:300, bauxite:0, bucket:2, torch:0, devMat:0, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬5æµ·åŸŸ"]},
    {id:"40", area:"5", name:"æ°´ä¸Šæ©Ÿå‰ç·šè¼¸é€", duration:410, fuel:300, ammo:300, steel:0, bauxite:100, bucket:1, torch:0, devMat:0, screw:0, boxS:3, boxM:0, boxL:0, tags:["ç¬¬5æµ·åŸŸ"]},
    {id:"E1", area:"5", name:"ãƒ©ãƒã‚¦ãƒ«æ–¹é¢è‰¦éšŠé€²å‡º", duration:450, fuel:0, ammo:600, steel:600, bauxite:1000, bucket:0, torch:0, devMat:0, screw:1, boxS:0, boxM:0, boxL:2, tags:["ç¬¬5æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"E2", area:"5", name:"å¼·è¡Œé¼ è¼¸é€ä½œæˆ¦", duration:185, fuel:0, ammo:480, steel:0, bauxite:0, bucket:2, torch:0, devMat:0, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬5æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},

    // --- ç¬¬ 7 æµ·åŸŸï¼šå—è¥¿æµ·åŸŸ ---
    {id:"41", area:"7", name:"ãƒ–ãƒ«ãƒã‚¤æ³Šåœ°æ²–å“¨æˆ’", duration:60, fuel:100, ammo:0, steel:0, bauxite:20, bucket:1, torch:0, devMat:1, screw:0, boxS:0, boxM:0, boxL:0, tags:["ç¬¬7æµ·åŸŸ"]},
    {id:"42", area:"7", name:"ãƒŸèˆ¹å›£è­·è¡›(ä¸€å·èˆ¹å›£)", duration:480, fuel:800, ammo:0, steel:0, bauxite:200, bucket:0, torch:3, devMat:0, screw:0, boxS:0, boxM:0, boxL:1, tags:["ç¬¬7æµ·åŸŸ","æœˆå¸¸"]},
    {id:"43", area:"7", name:"ãƒŸèˆ¹å›£è­·è¡›(äºŒå·èˆ¹å›£)", duration:720, fuel:2000, ammo:0, steel:0, bauxite:400, bucket:0, torch:0, devMat:4, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬7æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]},
    {id:"44", area:"7", name:"èˆªç©ºè£…å‚™è¼¸é€ä»»å‹™", duration:600, fuel:0, ammo:200, steel:0, bauxite:800, bucket:0, torch:0, devMat:4, screw:0, boxS:0, boxM:0, boxL:2, tags:["ç¬¬7æµ·åŸŸ","æœˆå¸¸"]},
    {id:"45", area:"7", name:"ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆèˆ¹å›£è­·è¡›", duration:200, fuel:40, ammo:0, steel:0, bauxite:220, bucket:0, torch:0, devMat:0, screw:0, boxS:0, boxM:1, boxL:0, tags:["ç¬¬7æµ·åŸŸ"]},
    {id:"46", area:"7", name:"å—è¥¿æµ·åŸŸæˆ¦é—˜å“¨æˆ’", duration:210, fuel:300, ammo:0, steel:150, bauxite:380, bucket:0, torch:0, devMat:3, screw:1, boxS:0, boxM:0, boxL:0, tags:["ç¬¬7æµ·åŸŸ","æœˆå¸¸","äº¤æˆ°"]}
];

const weightConfigs = [
    {id:"w_fuel", label:"â›½ ç‡ƒæ–™", val:1.0}, {id:"w_ammo", label:"ğŸ’£ å½ˆè—¥", val:1.0},
    {id:"w_steel", label:"ğŸ—ï¸ é‹¼æ", val:1.0}, {id:"w_bauxite", label:"âœˆï¸ é‹åœŸ", val:1.0},
    {id:"w_bucket", label:"ğŸ’§ æ°´æ¡¶", val:1.0}, {id:"w_devMat", label:"ğŸ› ï¸ é–‹ç™¼", val:1.0},
    {id:"w_screw", label:"ğŸ”¨ èºçµ²", val:1.0}, {id:"w_torch", label:"ğŸ”« ç«æ§", val:1.0},
    {id:"w_daihatsu", label:"ğŸ’° å¤§ç™¼%", val:0}
];

let state = { isGS: false, hideMonthly: false, hideIncompatible: false, sortKey: 'score', isAsc: false };

// åˆå§‹åŒ– UI
function init() {
    const panel = document.getElementById('weightPanel');
    
    panel.innerHTML = `<div class="section-title">âš–ï¸ æ”¶ç›Šæ¬Šé‡è¨­å®š</div> 
                        <div class="control-panel">
    ${weightConfigs.map(c => `
        <div class="weight-item">            
            <label>${c.label}</label>
            <input type="number" id="${c.id}" value="${c.val}" oninput="updateUI()">
        </div>
    `).join('')
    }`;
    updateUI();
}

function updateTime() {
    const val = parseInt(document.getElementById('intervalSlider').value);
    document.getElementById('textTime').innerText = `${Math.floor(val/60)} å°æ™‚ ${val%60} åˆ†é˜`;
    updateUI();
}

function toggleOption(key) {
    state[key] = !state[key];
    const btnMap = { isGS:'btnGS', hideMonthly:'btnMon', hideIncompatible:'btnLimit' };
    const labelMap = { isGS:'âœ¨ å¤§æˆåŠŸ', hideMonthly:'ğŸš« éš±è—æœˆå¸¸', hideIncompatible:'â³ éš±è—ä¸åˆé©' };
    const btn = document.getElementById(btnMap[key]);
    btn.classList.toggle('active', state[key]);
    btn.innerText = `${labelMap[key]}: ${state[key]?'ON':'OFF'}`;
    updateUI();
}

function applyPreset(type) {
    const fields = ['w_fuel', 'w_ammo', 'w_steel', 'w_bauxite', 'w_bucket', 'w_screw', 'w_torch', 'w_devMat', 'w_boxS', 'w_boxM', 'w_boxL', 'w_daihatsu'];
    if (type === 'reset') {
        const vals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
        fields.forEach((id, i) => document.getElementById(id).value = vals[i]);
    } else {
    document.getElementById('w_fuel').value = (type === 'fuel' ? 3 : 1.0);
    document.getElementById('w_ammo').value = (type === 'ammo' ? 3 : 1.0);
    document.getElementById('w_steel').value = (type === 'steel' ? 3 : 1.0);
    document.getElementById('w_bauxite').value = (type === 'bauxite' ? 3 : 1.0);
    document.getElementById('w_bucket').value = (type === 'bucket' ? 500 : 1.0);
    }
    
    updateUI();
}

function updateUI() {
    const interval = parseInt(document.getElementById('intervalSlider').value);
    const search = document.getElementById('searchBar').value.toLowerCase();
    
    const w = {};
    weightConfigs.forEach(c => w[c.id.replace('w_','')] = parseFloat(document.getElementById(c.id).value)||0);

    // å¤§ç™¼å‹•è‰‡åŠ æˆ
    const daihatsu = 1 + (w.daihatsu / 100);

    // å¤§æˆåŠŸåŠ æˆ
    const gsMult = state.isGS ? 1.5 : 1.0;

    // å‰¯ç”¢ç‰©å¤§æˆåŠŸåŠ æˆ(å‡è¨­ç²å¾—æ©Ÿç‡ç‚º 50%)
    const prob = state.isGS ? 1.0 : 0.5;

    let rows = expeditionDB.map(exp => {
        // æ™‚é–“ç¨€é‡‹é‚è¼¯ï¼š å¦‚æœä½  2 å°æ™‚æ‰å›ä¾†ä¸€æ¬¡ï¼Œå³ä¾¿é å¾åªè¦ 15 åˆ†é˜ï¼Œç”¢èƒ½ä¹Ÿæœƒè¢«ã€Œç¨€é‡‹ã€æˆ 2 å°æ™‚ã€‚
        const effectiveTime = Math.max(exp.duration, interval);
        const hFactor = 60 / effectiveTime;

        // è³‡æºç²å–é‡ * å¤§æˆåŠŸåŠ æˆ * å¤§ç™¼å‹•æŒº * æ™‚é–“é–“æ ¼
        const yFuel = exp.fuel * gsMult * daihatsu * hFactor;
        const yAmmo = exp.ammo * gsMult * daihatsu * hFactor;
        const ySteel = exp.steel * gsMult * daihatsu * hFactor;
        const yBaux = exp.bauxite * gsMult * daihatsu * hFactor;
        
        //å‰¯ç”¢ç‰©ç²å–é‡ * å‰¯ç”¢ç‰©å¤§æˆåŠŸåŠ æˆ * æ™‚é–“é–“æ ¼
        const yBucket = (exp.bucket || 0) * prob * hFactor;
        const yDev = (exp.devMat || 0) * prob * hFactor;
        const yScrew = (exp.screw || 0) * (state.isGS ? 1 : 0) * hFactor;
        const yTorch = (exp.torch || 0) * prob * hFactor;

        const score = (yFuel * w.fuel) + (yAmmo * w.ammo) + (ySteel * w.steel) + (yBaux * w.bauxite) + 
                      (yBucket * w.bucket) + (yDev * w.devMat) + (yScrew * w.screw) + (yTorch * w.torch);

        // æ•ˆç‡åˆ¤å®šï¼šå¤ªé•·æˆ–å¤ªçŸ­(ç¨€é‡‹è¶…é25%)
        const isTooLong = (interval > 0 && exp.duration > interval * 1.75);
        const isTooShort = (interval > 0 && exp.duration < interval * 0.75);
        const isNotFit = isTooLong || isTooShort;

        return { ...exp, yFuel, yAmmo, ySteel, yBaux, yBucket, yDev, yScrew, yTorch, score, isNotFit, isTooLong };
    }).filter(exp => {
        if (state.hideMonthly && exp.tags.includes("æœˆå¸¸")) return false;
        if (state.hideIncompatible && exp.isNotFit) return false;
        return (exp.id + exp.name + exp.tags.join(',')).toLowerCase().includes(search);
    });

    // æ¨è–¦ Logic
    const recs = [...rows].filter(r => !r.isNotFit).sort((a,b) => b.score - a.score).slice(0, 3);
    const recContainer = document.getElementById('recFleetCards');
    if(recs.length > 0) {
        recContainer.innerHTML = recs.map((r, i) => `
            <div class="rec-card">
                <div style="font-size:10px; color:#f39c12;">ç¬¬ ${i+2} è‰¦éšŠ</div>
                <div style="font-weight:bold;">${r.id} ${r.name}</div>
            </div>
        `).join('');
        const sumF = recs.reduce((s, r) => s + r.yFuel, 0);
        const sumA = recs.reduce((s, r) => s + r.yAmmo, 0);
        const sumS = recs.reduce((s, r) => s + r.ySteel, 0);
        const sumB = recs.reduce((s, r) => s + r.yBaux, 0);
        const sumBk = recs.reduce((s, r) => s + r.yBucket, 0);
        const sumD = recs.reduce((s, r) => s + r.yDev, 0);
        const sumSc = recs.reduce((s, r) => s + r.yScrew, 0);
        const sumT = recs.reduce((s, r) => s + r.yTorch, 0);

        document.getElementById('recTotalStats').innerHTML = `<b>é ä¼°æ™‚æ”¶ï¼š</b><br>
        â›½ ç‡ƒæ–™ ${sumF.toFixed(0)} | ğŸ’£ å½ˆè—¥ ${sumA.toFixed(0)}
        | ğŸ—ï¸ é‹¼æ ${sumS.toFixed(0)} | âœˆï¸ é‹åœŸ ${sumB.toFixed(0)}
        | ğŸ’§ æ°´æ¡¶ ${sumBk.toFixed(0)} | ğŸ”¨ èºçµ² ${sumSc.toFixed(0)}
        | ğŸ”« ç«æ§ ${sumT.toFixed(0)} | ğŸ› ï¸ é–‹ç™¼ ${sumD.toFixed(0)}
        | ğŸ“¦ å°ç®± ${sumA.toFixed(0)}
        | ğŸ“¦ ä¸­ç®± ${sumA.toFixed(0)} | ğŸ“¦ å¤§ç®± ${sumA.toFixed(0)}
        <br>ğŸ› ï¸é–‹ç™¼ ${(recs.reduce((s,r)=>s+r.yDev,0)).toFixed(1)} / hr`;
    }

    rows.sort((a,b) => {
        let valA = a[state.sortKey];
        let valB = b[state.sortKey];
        
        // é‡å° ID é€²è¡Œè‡ªç„¶æ’åº (1 -> 2 -> 10)
        if (state.sortKey === 'id') {
            return (state.isAsc ? 1 : -1) * valA.localeCompare(valB, undefined, {numeric: true, sensitivity: 'base'});
        }
        // é‡å°æ•¸å€¼é€²è¡Œæ’åº
        if (valA === valB) {
            return a.id.localeCompare(b.id, undefined, {numeric: true});
        }
        return (state.isAsc ? 1 : -1) * (valA > valB ? 1 : -1);
    });

    document.getElementById('tbody').innerHTML = rows.map(exp => `
        <tr class="${exp.isNotFit ? 'disabled' : ''}">
            <td><b>${exp.id}</b><span class="area-tag">ç¬¬ ${exp.area} æµ·åŸŸ</span></td>
            <td style="text-align:left">
                <div style="font-weight:bold;">${exp.name}</div>
                ${exp.tags.map(t => `<span class="badge ${getTagClass(t)}">${t}</span>`).join('')}
            </td>
            <td>${exp.duration}m</td>
            <td class="res-val" style="color:var(--fuel)">${exp.yFuel.toFixed(0)}</td>
            <td class="res-val" style="color:var(--ammo)">${exp.yAmmo.toFixed(0)}</td>
            <td class="res-val" style="color:var(--steel)">${exp.ySteel.toFixed(0)}</td>
            <td class="res-val" style="color:var(--bauxite)">${exp.yBaux.toFixed(0)}</td>
            <td style="font-size:12px; text-align:left">
                ${exp.yBucket>0?`ğŸ’§${exp.yBucket.toFixed(1)} `:''}${exp.yDev>0?`ğŸ› ï¸${exp.yDev.toFixed(1)} `:''}${exp.yScrew>0?`ğŸ”¨${exp.yScrew.toFixed(1)} `:''}
            </td>
            <td class="score-col">${exp.score.toFixed(0)}</td>
        </tr>
    `).join('');
}

function getTagClass(tag) {
    const map = {"æ°´æ¡¶":"tag-bucket", "ç‡ƒæ–™":"tag-fuel", "å½ˆè—¥":"tag-ammo", "é‹åœŸ":"tag-bauxite", "é‹¼æ":"tag-steel", "æœˆå¸¸":"tag-monthly", "äº¤æˆ°":"tag-combat"};
    return map[tag] || "tag-default";
}

function resort(k) {
    if (state.sortKey === k) state.isAsc = !state.isAsc;
    else { state.sortKey = k; state.isAsc = false; }
    updateUI();
}

init();
</script>
</body>
</html>